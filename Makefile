VERSION=0.4

PLAYER="Pippi"
PLAYER_LANG="en"

TAIKO_TITLE="New Drummer"
TAIKO_TITLE_LANG="ja"

INKSCAPE=inkscape
INKSCAPE_FLAGS=-b "\#000000" -y 0.0

IMAGES_FOLLOWPOINT=\
	followpoint-0.png \
	followpoint-1.png \
	followpoint-2.png \
	followpoint-3.png \
	followpoint-4.png \
	followpoint-5.png \
	followpoint-6.png \
	followpoint-7.png \
	followpoint-8.png \
	followpoint-9.png \
	followpoint-10.png \
	followpoint-11.png \
	followpoint-12.png \
	followpoint-13.png \
	followpoint-14.png \
	followpoint-15.png \
	followpoint-16.png \
	followpoint-17.png \
	followpoint-18.png \
	followpoint-19.png \
	followpoint-20.png \
	followpoint-21.png \
	followpoint-22.png \
	followpoint-23.png \
	followpoint-24.png \
	followpoint-25.png \
	followpoint-26.png \
	followpoint-27.png \
	followpoint-28.png \
	followpoint-29.png \
	followpoint-30.png \
	followpoint-31.png \
	followpoint-32.png \
	followpoint-33.png \
	followpoint-34.png \
	followpoint-35.png \
	followpoint-36.png \
	followpoint-37.png \
	followpoint-38.png \
	followpoint-39.png \
	followpoint-40.png \
	followpoint-41.png \
	followpoint-42.png \
	followpoint-43.png \
	followpoint-44.png \
	followpoint-45.png \
	followpoint-46.png \
	followpoint-47.png \
	followpoint-48.png \
	followpoint-49.png \
	followpoint-50.png \
	followpoint-51.png \
	followpoint-52.png \
	followpoint-53.png \
	followpoint-54.png \
	followpoint-55.png \
	followpoint-56.png \
	followpoint-57.png \
	followpoint-58.png \
	followpoint-59.png \
	followpoint-60.png \
	followpoint-61.png \
	followpoint-62.png \
	followpoint-63.png \
	followpoint-64.png \
	followpoint-65.png \
	followpoint-66.png \
	followpoint-67.png \
	followpoint-68.png \
	followpoint-69.png \
	followpoint-70.png \
	followpoint-71.png

IMAGES_HIT0=\
	hit0-0.png \
	hit0-1.png \
	hit0-2.png \
	hit0-3.png \
	hit0-4.png \
	hit0-5.png \
	hit0-6.png \
	hit0-7.png \
	hit0-8.png \
	hit0-9.png \
	hit0-10.png \
	hit0-11.png \
	hit0-12.png \
	hit0-13.png \
	hit0-14.png \
	hit0-15.png \
	hit0-16.png \
	hit0-17.png \
	hit0-18.png \
	hit0-19.png \
	hit0-20.png \
	hit0-21.png \
	hit0-22.png \
	hit0-23.png \
	hit0-24.png \
	hit0-25.png \
	hit0-26.png \
	hit0-27.png \
	hit0-28.png \
	hit0-29.png

IMAGES_HIT50=\
	hit50-0.png \
	hit50-1.png \
	hit50-2.png \
	hit50-3.png \
	hit50-4.png \
	hit50-5.png \
	hit50-6.png \
	hit50-7.png \
	hit50-8.png \
	hit50-9.png \
	hit50-10.png \
	hit50-11.png \
	hit50-12.png \
	hit50-13.png \
	hit50-14.png \
	hit50-15.png \
	hit50-16.png \
	hit50-17.png \
	hit50-18.png \
	hit50-19.png \
	hit50-20.png \
	hit50-21.png \
	hit50-22.png \
	hit50-23.png \
	hit50-24.png \
	hit50-25.png \
	hit50-26.png \
	hit50-27.png \
	hit50-28.png \
	hit50-29.png

IMAGES_HIT100=\
	hit100-0.png \
	hit100-1.png \
	hit100-2.png \
	hit100-3.png \
	hit100-4.png \
	hit100-5.png \
	hit100-6.png \
	hit100-7.png \
	hit100-8.png \
	hit100-9.png \
	hit100-10.png \
	hit100-11.png \
	hit100-12.png \
	hit100-13.png \
	hit100-14.png \
	hit100-15.png \
	hit100-16.png \
	hit100-17.png \
	hit100-18.png \
	hit100-19.png \
	hit100-20.png \
	hit100-21.png \
	hit100-22.png \
	hit100-23.png \
	hit100-24.png \
	hit100-25.png \
	hit100-26.png \
	hit100-27.png \
	hit100-28.png \
	hit100-29.png

IMAGES_HIT100K=\
	hit100k-0.png \
	hit100k-1.png \
	hit100k-2.png \
	hit100k-3.png \
	hit100k-4.png \
	hit100k-5.png \
	hit100k-6.png \
	hit100k-7.png \
	hit100k-8.png \
	hit100k-9.png \
	hit100k-10.png \
	hit100k-11.png \
	hit100k-12.png \
	hit100k-13.png \
	hit100k-14.png \
	hit100k-15.png \
	hit100k-16.png \
	hit100k-17.png \
	hit100k-18.png \
	hit100k-19.png \
	hit100k-20.png \
	hit100k-21.png \
	hit100k-22.png \
	hit100k-23.png \
	hit100k-24.png \
	hit100k-25.png \
	hit100k-26.png \
	hit100k-27.png \
	hit100k-28.png \
	hit100k-29.png \

IMAGES_SLIDERENDMISS=\
	sliderendmiss-0.png \
	sliderendmiss-1.png \
	sliderendmiss-2.png \
	sliderendmiss-3.png \
	sliderendmiss-4.png \
	sliderendmiss-5.png \
	sliderendmiss-6.png \
	sliderendmiss-7.png \
	sliderendmiss-8.png \
	sliderendmiss-9.png \
	sliderendmiss-10.png \
	sliderendmiss-11.png \
	sliderendmiss-12.png \
	sliderendmiss-13.png \
	sliderendmiss-14.png \
	sliderendmiss-15.png \
	sliderendmiss-16.png \
	sliderendmiss-17.png \
	sliderendmiss-18.png \
	sliderendmiss-19.png \
	sliderendmiss-20.png \
	sliderendmiss-21.png \
	sliderendmiss-22.png \
	sliderendmiss-23.png \
	sliderendmiss-24.png \
	sliderendmiss-25.png \
	sliderendmiss-26.png \
	sliderendmiss-27.png \
	sliderendmiss-28.png \
	sliderendmiss-29.png

IMAGES_SLIDERTICKMISS=\
	slidertickmiss-0.png \
	slidertickmiss-1.png \
	slidertickmiss-2.png \
	slidertickmiss-3.png \
	slidertickmiss-4.png \
	slidertickmiss-5.png \
	slidertickmiss-6.png \
	slidertickmiss-7.png \
	slidertickmiss-8.png \
	slidertickmiss-9.png \
	slidertickmiss-10.png \
	slidertickmiss-11.png \
	slidertickmiss-12.png \
	slidertickmiss-13.png \
	slidertickmiss-14.png \
	slidertickmiss-15.png \
	slidertickmiss-16.png \
	slidertickmiss-17.png \
	slidertickmiss-18.png \
	slidertickmiss-19.png \
	slidertickmiss-20.png \
	slidertickmiss-21.png \
	slidertickmiss-22.png \
	slidertickmiss-23.png \
	slidertickmiss-24.png \
	slidertickmiss-25.png \
	slidertickmiss-26.png \
	slidertickmiss-27.png \
	slidertickmiss-28.png \
	slidertickmiss-29.png

IMAGES_TAIKO_HIT0=\
	taiko-hit0-0.png \
	taiko-hit0-1.png \
	taiko-hit0-2.png \
	taiko-hit0-3.png \
	taiko-hit0-4.png \
	taiko-hit0-5.png

IMAGES_TAIKO_HIT100=\
	taiko-hit100-0.png \
	taiko-hit100-1.png \
	taiko-hit100-2.png \
	taiko-hit100-3.png \
	taiko-hit100-4.png \
	taiko-hit100-5.png \
	taiko-hit100-6.png \
	taiko-hit100-7.png \
	taiko-hit100-8.png \
	taiko-hit100-9.png

IMAGES_TAIKO_HIT100K=\
	taiko-hit100k-0.png \
	taiko-hit100k-1.png \
	taiko-hit100k-2.png \
	taiko-hit100k-3.png \
	taiko-hit100k-4.png \
	taiko-hit100k-5.png \
	taiko-hit100k-6.png \
	taiko-hit100k-7.png \
	taiko-hit100k-8.png \
	taiko-hit100k-9.png

IMAGES_TAIKO_HIT300=\
	taiko-hit300-0.png \
	taiko-hit300-1.png \
	taiko-hit300-2.png \
	taiko-hit300-3.png \
	taiko-hit300-4.png \
	taiko-hit300-5.png \
	taiko-hit300-6.png \
	taiko-hit300-7.png \
	taiko-hit300-8.png \
	taiko-hit300-9.png

IMAGES_TAIKO_HIT300K=\
	taiko-hit300k-0.png \
	taiko-hit300k-1.png \
	taiko-hit300k-2.png \
	taiko-hit300k-3.png \
	taiko-hit300k-4.png \
	taiko-hit300k-5.png \
	taiko-hit300k-6.png \
	taiko-hit300k-7.png \
	taiko-hit300k-8.png \
	taiko-hit300k-9.png

IMAGES_SD=\
	approachcircle.png \
	cursor.png \
	cursormiddle.png \
	cursortrail.png \
	$(IMAGES_FOLLOWPOINT) \
	hit0.png \
	$(IMAGES_HIT0) \
	hit50.png \
	$(IMAGES_HIT50) \
	hit100.png \
	$(IMAGES_HIT100) \
	hit100k.png \
	$(IMAGES_HIT100K) \
	hit300.png \
	hit300-0.png \
	hit300k.png \
	hit300k-0.png \
	hit300g.png \
	hit300g-0.png \
	hitcircle.png \
	hitcircleoverlay.png \
	hitcircleselect.png \
	mania-hit0.png \
	mania-hit50.png \
	mania-hit100.png \
	mania-hit200.png \
	mania-hit300.png \
	mania-hit300g.png \
	pippidonclear.png \
	pippidonfail.png \
	pippidonidle.png \
	pippidonkiai.png \
	reversearrow.png \
	scorebar-bg.png \
	scorebar-colour.png \
	scorebar-ki.png \
	scorebar-kidanger.png \
	scorebar-kidanger2.png \
	score-0.png \
	score-1.png \
	score-2.png \
	score-3.png \
	score-4.png \
	score-5.png \
	score-6.png \
	score-7.png \
	score-8.png \
	score-9.png \
	score-comma.png \
	score-dot.png \
	score-percent.png \
	score-pp.png \
	score-x.png \
	sliderb.png \
	sliderendcircle.png \
	sliderendcircleoverlay.png \
	$(IMAGES_SLIDERENDMISS) \
	sliderfollowcircle.png \
	sliderscorepoint.png \
	$(IMAGES_SLIDERTICKMISS) \
	spinner-approachcircle.png \
	spinner-background.png \
	spinner-circle.png \
	spinner-clear.png \
	spinner-metre.png \
	spinner-rpm.png \
	spinner-spin.png \
	spinner-warning.png \
	taiko-bar-left.png \
	taiko-bar-right.png \
	taiko-bar-right-glow.png \
	taiko-barline.png \
	taiko-drum-inner.png \
	taiko-drum-outer.png \
	taiko-glow.png \
	taiko-hit0.png \
	$(IMAGES_TAIKO_HIT0) \
	taiko-hit100.png \
	$(IMAGES_TAIKO_HIT100) \
	taiko-hit100k.png \
	$(IMAGES_TAIKO_HIT100K) \
	taiko-hit300.png \
	$(IMAGES_TAIKO_HIT300) \
	taiko-hit300g.png \
	$(IMAGES_TAIKO_HIT300K) \
	taiko-nameplate.png \
	taiko-roll-end.png \
	taiko-roll-middle.png \
	taiko-slider.png \
	taiko-slider-fail.png \
	taikobigcircle.png \
	taikobigcircleoverlay.png \
	taikohitcircle.png \
	taikohitcircleoverlay.png

IMAGES_HD=$(IMAGES_SD:.png=@2x.png)

OBJECTS=$(IMAGES_SD) $(IMAGES_HD)

ANIMATIONS=\
	animations/taiko-hitexplosion.png \
	animations/taiko-hitexplosion@2x.png \
	followpoint \
	hit0 \
	hit50 \
	hit100 \
	hit100k \
	sliderendmiss \
	slidertickmiss \
	taiko-hit0 \
	taiko-hit100 \
	taiko-hit100k \
	taiko-hit300 \
	taiko-hit300k \
	taiko-hit0@2x \
	taiko-hit100@2x \
	taiko-hit100k@2x \
	taiko-hit300@2x \
	taiko-hit300k@2x

RESOURCES=\
	skin.ini \
	skininfo.json \
	MainHUDComponents.json \
	Playfield.json \
	LICENSE

.PHONY: all
all:
	@DEFRINGE=$(DEFRINGE) \
		$(MAKE) tools && \
		$(MAKE) irodori-$(VERSION).osk

.SUFFIXES:
.SUFFIXES: .svg .png @2x.png

.svg.png:
	$(INKSCAPE) $(INKSCAPE_FLAGS) --export-type=png --export-filename=$@ $<
	@if [ x$(DEFRINGE) = x1 ]; then \
		echo tools/defringe $@ $@; \
		tools/defringe $@ $@; \
	fi

.svg@2x.png:
	$(INKSCAPE) $(INKSCAPE_FLAGS) --export-type=png --export-dpi=192 --export-filename=$@ $<
	@if [ x$(DEFRINGE) = x1 ]; then \
		echo tools/defringe $@ $@; \
		tools/defringe $@ $@; \
	fi

irodori-$(VERSION).osk: $(OBJECTS) $(RESOURCES)
	if [ -e $@ ]; then rm $@; fi
	zip -r $@ $(RESOURCES) $(OBJECTS)

taiko-nameplate.svg: animations/taiko-nameplate.py animations/taiko-nameplate.svg
	animations/taiko-nameplate.py \
		--title $(TAIKO_TITLE) \
		--title-lang $(TAIKO_TITLE_LANG) \
		--player $(PLAYER) \
		--player-lang $(PLAYER_LANG) \
		animations/taiko-nameplate.svg $@

followpoint: animations/followpoint.py animations/followpoint.svg
	animations/followpoint.py animations/followpoint.svg .
	touch followpoint
$(IMAGES_FOLLOWPOINT:.png=.svg): followpoint

hit0: animations/animate_miss.py animations/hit0.svg
	animations/animate_miss.py animations/hit0.svg .
	touch hit0
$(IMAGES_HIT0:.png=.svg): hit0

hit50: animations/animate_hit.py animations/hit50.svg
	animations/animate_hit.py animations/hit50.svg .
	touch hit50
$(IMAGES_HIT50:.png=.svg): hit50

hit100: animations/animate_hit.py animations/hit100.svg
	animations/animate_hit.py animations/hit100.svg .
	touch hit100
$(IMAGES_HIT100:.png=.svg): hit100

hit100k: animations/animate_hit.py animations/hit100k.svg
	animations/animate_hit.py animations/hit100k.svg .
	touch hit100k
$(IMAGES_HIT100K:.png=.svg): hit100k

sliderendmiss: animations/animate_miss.py animations/sliderendmiss.svg
	animations/animate_miss.py animations/sliderendmiss.svg .
	touch sliderendmiss
$(IMAGES_SLIDERENDMISS:.png=.svg): sliderendmiss

slidertickmiss: animations/animate_miss.py animations/slidertickmiss.svg
	animations/animate_miss.py animations/slidertickmiss.svg .
	touch slidertickmiss
$(IMAGES_SLIDERTICKMISS:.png=.svg): slidertickmiss

taiko-hit0: tools/taiko-explosion.o animations/taiko-hitexplosion.png
	tools/taiko-explosion -t 4 -o taiko-hit0 animations/taiko-hitexplosion.png
	touch taiko-hit0
$(IMAGES_TAIKO_HIT0): taiko-hit0

taiko-hit100: tools/taiko-explosion.o animations/taiko-hitexplosion.png
	tools/taiko-explosion -t 1 -o taiko-hit100 animations/taiko-hitexplosion.png
	touch taiko-hit100
$(IMAGES_TAIKO_HIT100): taiko-hit100

taiko-hit100k: tools/taiko-explosion.o animations/taiko-hitexplosion.png
	tools/taiko-explosion -t 3 -o taiko-hit100k animations/taiko-hitexplosion.png
	touch taiko-hit100k
$(IMAGES_TAIKO_HIT100K): taiko-hit100k

taiko-hit300: tools/taiko-explosion.o animations/taiko-hitexplosion.png
	tools/taiko-explosion -t 0 -o taiko-hit300 animations/taiko-hitexplosion.png
	touch taiko-hit300
$(IMAGES_TAIKO_HIT300): taiko-hit300

taiko-hit300k: tools/taiko-explosion.o animations/taiko-hitexplosion.png
	tools/taiko-explosion -t 2 -o taiko-hit300k animations/taiko-hitexplosion.png
	touch taiko-hit300k
$(IMAGES_TAIKO_HIT300K): taiko-hit300k

taiko-hit0@2x: tools/taiko-explosion.o animations/taiko-hitexplosion@2x.png
	tools/taiko-explosion --hd -t 4 -o taiko-hit0 animations/taiko-hitexplosion@2x.png
	touch taiko-hit0@2x
$(IMAGES_TAIKO_HIT0:.png=@2x.png): taiko-hit0@2x

taiko-hit100@2x: tools/taiko-explosion.o animations/taiko-hitexplosion@2x.png
	tools/taiko-explosion --hd -t 1 -o taiko-hit100 animations/taiko-hitexplosion@2x.png
	touch taiko-hit100@2x
$(IMAGES_TAIKO_HIT100:.png=@2x.png): taiko-hit100@2x

taiko-hit100k@2x: tools/taiko-explosion.o animations/taiko-hitexplosion@2x.png
	tools/taiko-explosion --hd -t 3 -o taiko-hit100k animations/taiko-hitexplosion@2x.png
	touch taiko-hit100k@2x
$(IMAGES_TAIKO_HIT100K:.png=@2x.png): taiko-hit100k@2x

taiko-hit300@2x: tools/taiko-explosion.o animations/taiko-hitexplosion@2x.png
	tools/taiko-explosion --hd -t 0 -o taiko-hit300 animations/taiko-hitexplosion@2x.png
	touch taiko-hit300@2x
$(IMAGES_TAIKO_HIT300:.png=@2x.png): taiko-hit300@2x

taiko-hit300k@2x: tools/taiko-explosion.o animations/taiko-hitexplosion@2x.png
	tools/taiko-explosion --hd -t 2 -o taiko-hit300k animations/taiko-hitexplosion@2x.png
	touch taiko-hit300k@2x
$(IMAGES_TAIKO_HIT300K:.png=@2x.png): taiko-hit300k@2x

.PHONY: tools
tools:
	cd tools && $(MAKE)

.PHONY: clean
clean:
	-cd tools && $(MAKE) clean
	-rm $(ANIMATIONS)
	-rm $(IMAGES_FOLLOWPOINT:.png=.svg)
	-rm $(IMAGES_HIT0:.png=.svg)
	-rm $(IMAGES_HIT50:.png=.svg)
	-rm $(IMAGES_HIT100:.png=.svg)
	-rm $(IMAGES_HIT100K:.png=.svg)
	-rm $(IMAGES_SLIDERENDMISS:.png=.svg)
	-rm $(IMAGES_SLIDERTICKMISS:.png=.svg)
	-rm taiko-nameplate.svg
	-rm $(OBJECTS)
	-rm *.osk
